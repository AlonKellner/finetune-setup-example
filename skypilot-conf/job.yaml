name: job

resources:
  cloud: runpod
  accelerators: { A100-80GB:1, A100-80GB-SXM:1 }
  use_spot: true # Use spot instances to save cost.
  image_id: blabla:foofoo

setup: |
  git clone https://github.com/AlonKellner/finetune-setup-example.git .
  git checkout exp/$JOB_ID_EXP
  git reset --hard $JOB_ID_COMMIT
  git clean -df

run: |
  export PYSPY_PATH=src/train.pyspy
  uvx py-spy record -f raw -o "$PYSPY_PATH" --subprocesses --full-filenames -r 10 -- \
    /app/.venv/bin/python src/train.py
  /app/.venv/bin/python src/pyspy_upload.py
